CREATE DATABASE vet_db;
USE vet_db;

-- Tabla de Usuarios
CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre_usuario VARCHAR(50) UNIQUE NOT NULL,
    contrasena VARCHAR(255) NOT NULL,
    rol INT NOT NULL, -- 1: Administrador, 2: Veterinario, 3: Recepcionista, 4: Cliente
    nombre VARCHAR(100) NOT NULL,
    correo VARCHAR(100) NOT NULL,
    telefono VARCHAR(20)
);

-- Tabla de Mascotas
CREATE TABLE mascotas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    especie VARCHAR(50) NOT NULL,
    raza VARCHAR(50),
    edad INT,
    peso DECIMAL(5,2),
    foto VARCHAR(255), -- Ruta de foto (opcional)
    id_dueno INT NOT NULL,
    FOREIGN KEY (id_dueno) REFERENCES usuarios(id) ON DELETE CASCADE
);

-- Tabla de Citas
CREATE TABLE citas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_mascota INT NOT NULL,
    id_veterinario INT NOT NULL,
    fecha_hora DATETIME NOT NULL,
    estado ENUM('pendiente', 'confirmada', 'cancelada', 'realizada') DEFAULT 'pendiente',
    FOREIGN KEY (id_mascota) REFERENCES mascotas(id) ON DELETE CASCADE,
    FOREIGN KEY (id_veterinario) REFERENCES usuarios(id) ON DELETE CASCADE
);

-- Tabla de Productos
CREATE TABLE productos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    tipo ENUM('alimento', 'medicamento', 'accesorio') NOT NULL,
    precio DECIMAL(10,2) NOT NULL,
    stock INT DEFAULT 0
);

-- Tabla de Servicios
CREATE TABLE servicios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    precio DECIMAL(10,2) NOT NULL
);

-- Tabla de Ventas
CREATE TABLE ventas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    fecha DATETIME NOT NULL,
    id_cliente INT NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (id_cliente) REFERENCES usuarios(id) ON DELETE CASCADE
);

-- Detalles de Ventas (productos o servicios)
CREATE TABLE detalles_ventas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_venta INT NOT NULL,
    tipo_item ENUM('producto', 'servicio') NOT NULL,
    id_item INT NOT NULL,
    cantidad INT NOT NULL,
    precio DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (id_venta) REFERENCES ventas(id) ON DELETE CASCADE
);

-- Tabla de Historial MÃ©dico
CREATE TABLE historiales_medicos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_mascota INT NOT NULL,
    fecha DATETIME NOT NULL,
    diagnostico TEXT,
    tratamiento TEXT,
    vacunas TEXT,
    evolucion TEXT,
    tipo ENUM('vacunacion', 'internacion', 'revision', 'desparasitacion', 'peluqueria', 'otro') NOT NULL,
    adjuntos VARCHAR(255), -- Ruta de archivos (opcional)
    FOREIGN KEY (id_mascota) REFERENCES mascotas(id) ON DELETE CASCADE
);

-- Ejemplos de datos iniciales
INSERT INTO usuarios (nombre_usuario, contrasena, rol, nombre, correo) VALUES 
('admin', '$2y$10$K.4w5zY8zF4z4z4z4z4z4uK4z4z4z4z4z4z4z4z4z4z4z4z4z4z4', 1, 'Administrador', 'admin@ejemplo.com'), -- pass: admin123
('vet1', '$2y$10$K.4w5zY8zF4z4z4z4z4z4uK4z4z4z4z4z4z4z4z4z4z4z4z4z4z4', 2, 'Veterinario1', 'vet1@ejemplo.com'), -- pass: vet123
('rec1', '$2y$10$K.4w5zY8zF4z4z4z4z4z4uK4z4z4z4z4z4z4z4z4z4z4z4z4z4z4', 3, 'Recepcionista1', 'rec1@ejemplo.com'), -- pass: rec123
('cliente1', '$2y$10$K.4w5zY8zF4z4z4z4z4z4uK4z4z4z4z4z4z4z4z4z4z4z4z4z4z4', 4, 'Cliente1', 'cliente1@ejemplo.com'); -- pass: client123